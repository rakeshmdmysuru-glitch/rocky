<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Academic Activities</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    input, select { margin: 5px 10px 5px 0; padding: 5px; }
  </style>
</head>
<body>

<h1>Academic Activities</h1>

<!-- Filters -->
<label for="typeFilter">Type:</label>
<select id="typeFilter">
  <option value="">All</option>
  <option value="Journal">Journal</option>
  <option value="Conference">Conference</option>
  <option value="Workshop">Workshop</option>
</select>

<label for="yearFilter">Year:</label>
<select id="yearFilter">
  <option value="">All</option>
</select>

<label for="searchFilter">Search:</label>
<input type="text" id="searchFilter" placeholder="Search Description">

<!-- Table -->
<table id="activity-table">
  <thead>
    <tr>
      <th>Sl No</th>
      <th>Date</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuqqWiO_Inm0kKaFXpskmLv8DtSvBM61iO_SKX8HdqYEBBWGASGeNMJfG6rFJFpQ/pub?output=csv";
let tableData = [];

fetch(csvUrl)
  .then(res => res.text())
  .then(csvText => {
    const parsed = Papa.parse(csvText, { header: true });
    tableData = parsed.data.map(row => ({
      sl: row.sl,
      date: row.date,
      type: row.type,
      description: row.description,
      year: new Date(row.date).getFullYear()
    }));
    populateYearFilter();
    renderTable();
  })
  .catch(err => console.error("Error loading CSV:", err));

const tbody = document.querySelector("#activity-table tbody");
const typeFilter = document.getElementById("typeFilter");
const yearFilter = document.getElementById("yearFilter");
const searchFilter = document.getElementById("searchFilter");

function renderTable() {
  tbody.innerHTML = "";
  const typeVal = typeFilter.value.toLowerCase();
  const yearVal = yearFilter.value;
  const searchVal = searchFilter.value.toLowerCase();

  tableData.forEach(row => {
    if ((typeVal === "" || row.type.toLowerCase() === typeVal) &&
        (yearVal === "" || row.year == yearVal) &&
        (searchVal === "" || row.description.toLowerCase().includes(searchVal))) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.sl}</td>
        <td>${row.date}</td>
        <td>${row.type}</td>
        <td>${row.description}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

function populateYearFilter() {
  const years = [...new Set(tableData.map(r => r.year))].sort((a,b)=>b-a);
  years.forEach(y => {
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    yearFilter.appendChild(opt);
  });
}

typeFilter.addEventListener("change", renderTable);
yearFilter.addEventListener("change", renderTable);
searchFilter.addEventListener("input", renderTable);
</script>

</body>
</html>
