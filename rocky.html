<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic CSV Table with Bootstrap</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  /* Make Description column take more space */
  table#activity-table th.description,
  table#activity-table td.description {
    width: 60%;
    word-wrap: break-word;
  }
  table#activity-table th,
  table#activity-table td {
    vertical-align: top;
  }
</style>
</head>
<body class="p-4">

<div class="container">
  <h2 class="mb-4">Publication Table</h2>

  <div class="row mb-3 g-2">
    <div class="col-md-3">
      <select id="typeFilter" class="form-select">
        <option value="">All Types</option>
      </select>
    </div>
    <div class="col-md-3">
      <select id="yearFilter" class="form-select">
        <option value="">All Years</option>
      </select>
    </div>
    <div class="col-md-6">
      <input type="text" id="searchFilter" class="form-control" placeholder="Search Description">
    </div>
  </div>

  <div class="table-responsive">
    <table id="activity-table" class="table table-bordered table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th style="width:5%;">Sl No</th>
          <th style="width:15%;">Date</th>
          <th style="width:15%;">Type</th>
          <th class="description">Description</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
// Replace with your CSV URL
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuqqWiO_Inm0kKaFXpskmLv8DtSvBM61iO_SKX8HdqYEBBWGASGeNMJfG6rFJFpQ/pub?output=csv";

let tableData = [];

fetch(csvUrl)
  .then(res => res.text())
  .then(csvText => {
    const parsed = Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      quoteChar: '"'
    });

    tableData = parsed.data.map(row => {
      const allFields = Object.values(row);
      const description = allFields.slice(3).join(", ") || row["Description"] || "";

      return {
        sl: row["Sl No"] || "",
        date: row["Date"] || "",
        type: row["Type"] || "",
        description: description,
        year: row["Date"] ? new Date(row["Date"]).getFullYear() : ""
      };
    });

    populateTypeFilter();
    populateYearFilter();
    renderTable();
  })
  .catch(err => console.error("Error loading CSV:", err));

const tbody = document.querySelector("#activity-table tbody");
const typeFilter = document.getElementById("typeFilter");
const yearFilter = document.getElementById("yearFilter");
const searchFilter = document.getElementById("searchFilter");

// Render table
function renderTable() {
  const typeVal = typeFilter.value.toLowerCase();
  const yearVal = yearFilter.value;
  const searchVal = searchFilter.value.toLowerCase();

  tbody.innerHTML = "";
  tableData.forEach(row => {
    if ((typeVal === "" || row.type.toLowerCase() === typeVal) &&
        (yearVal === "" || row.year == yearVal) &&
        (searchVal === "" || row.description.toLowerCase().includes(searchVal))) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.sl}</td>
        <td>${row.date}</td>
        <td>${row.type}</td>
        <td class="description">${row.description}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

// Populate filters
function populateTypeFilter() {
  const types = [...new Set(tableData.map(r => r.type))].sort();
  types.forEach(t => {
    if (t) {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      typeFilter.appendChild(opt);
    }
  });
}

function populateYearFilter() {
  const years = [...new Set(tableData.map(r => r.year))].sort((a,b)=>b-a);
  years.forEach(y => {
    if (y) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      yearFilter.appendChild(opt);
    }
  });
}

// Event listeners
typeFilter.addEventListener("change", renderTable);
yearFilter.addEventListener("change", renderTable);
searchFilter.addEventListener("input", renderTable);
</script>

</body>
</html>