<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic CSV Table</title>
</head>
<body>

<!-- Filters -->
<select id="typeFilter">
  <option value="">All Types</option>
</select>

<select id="yearFilter">
  <option value="">All Years</option>
</select>

<input type="text" id="searchFilter" placeholder="Search Description">

<!-- Table -->
<table border="1" id="activity-table" style="width:100%; table-layout: fixed;">
  <thead>
    <tr>
      <th>Sl No</th>
      <th>Date</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- PapaParse for CSV parsing -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
// Replace with your CSV URL
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuqqWiO_Inm0kKaFXpskmLv8DtSvBM61iO_SKX8HdqYEBBWGASGeNMJfG6rFJFpQ/pub?output=csv";

let tableData = [];

fetch(csvUrl)
  .then(res => res.text())
  .then(csvText => {
    // Parse CSV properly, keep quotes for Description
    const parsed = Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      quoteChar: '"'
    });

    tableData = parsed.data.map(row => {
      // Combine any extra fields into Description
      const allFields = Object.values(row);
      const description = allFields.slice(3).join(", ") || row["Description"] || "";

      return {
        sl: row["Sl No"] || "",
        date: row["Date"] || "",
        type: row["Type"] || "",
        description: description,
        year: row["Date"] ? new Date(row["Date"]).getFullYear() : ""
      };
    });

    populateTypeFilter();
    populateYearFilter();
    renderTable();
  })
  .catch(err => console.error("Error loading CSV:", err));

const tbody = document.querySelector("#activity-table tbody");
const typeFilter = document.getElementById("typeFilter");
const yearFilter = document.getElementById("yearFilter");
const searchFilter = document.getElementById("searchFilter");

// Render table with filters
function renderTable() {
  const typeVal = typeFilter.value.toLowerCase();
  const yearVal = yearFilter.value;
  const searchVal = searchFilter.value.toLowerCase();

  tbody.innerHTML = "";
  tableData.forEach(row => {
    if ((typeVal === "" || row.type.toLowerCase() === typeVal) &&
        (yearVal === "" || row.year == yearVal) &&
        (searchVal === "" || row.description.toLowerCase().includes(searchVal))) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.sl}</td>
        <td>${row.date}</td>
        <td>${row.type}</td>
        <td style="word-wrap: break-word;">${row.description}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

// Populate Type filter dynamically
function populateTypeFilter() {
  const types = [...new Set(tableData.map(r => r.type))].sort();
  types.forEach(t => {
    if (t) {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      typeFilter.appendChild(opt);
    }
  });
}

// Populate Year filter dynamically
function populateYearFilter() {
  const years = [...new Set(tableData.map(r => r.year))].sort((a,b)=>b-a);
  years.forEach(y => {
    if (y) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      yearFilter.appendChild(opt);
    }
  });
}

// Event listeners
typeFilter.addEventListener("change", renderTable);
yearFilter.addEventListener("change", renderTable);
searchFilter.addEventListener("input", renderTable);
</script>
</body>
</html>